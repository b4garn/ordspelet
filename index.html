<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Ordmatchningsspel</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #1e1e2f;
      color: #f0f0f0;
      text-align: center;
      padding: 20px;
      margin-bottom: 100px;
    }
    button, input {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      position: relative;
    }
    button {
      background-color: #4a90e2;
      color: #fff;
    }
    button:hover {
      background-color: #357ABD;
    }
    .correct {
      background-color: #5cb85c !important;
    }
    .wrong {
      background-color: #d9534f !important;
    }
    textarea {
      width: 500px;
      height: 200px;
      border-radius: 5px;
      border: 1px solid #ccc;
      padding: 10px;
      font-size: 16px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    h2 {
      margin: 20px 0;
    }
    progress {
      width: 80%;
      height: 20px;
      margin: 20px auto;
      display: block;
    }
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      20% { transform: translate(-2px, -2px) rotate(-1deg); }
      40% { transform: translate(-1px, 2px) rotate(1deg); }
      60% { transform: translate(2px, 1px) rotate(0deg); }
      80% { transform: translate(1px, -1px) rotate(1deg); }
      100% { transform: translate(1px, 1px) rotate(0deg); }
    }
    .shake {
      animation: shake 0.3s;
    }
    #buttonContainer {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
    }
    #buttonContainer button {
      background-color: #f39c12;
    }
  </style>
</head>
<body>
  <div id="inputSection">
    <h2>Klistra in din ordlista</h2>
    <textarea id="inputData">
censur – när någon stoppar eller tar bort saker som folk vill säga eller se, till exempel böcker eller filmer, så att inte allt kommer ut.
dold_marknadsföring – när man visar eller pratar om något som reklam fast inte säger att det är reklam, så att det ser ut som att någon verkligen bara gillar det.
dubbelriktad_kommunikation – när två parter pratar fram och tillbaka, som när du sms:ar en kompis och ni båda svarar varandra.
enkelriktad_kommunikation – när bara en person pratar eller skickar info utan att få svar, som när man lyssnar på radio.
fakta – grejer som är sanna och kan kontrolleras, som att jorden är rund.
förtal – när man pratar illa om någon och säger saker som inte är sanna för att göra dem illa.
hets_mot_folkgrupp – när man sprider elaka eller hotfulla saker om en viss grupp människor, till exempel ett folkslag eller religion.
influencer – en person på nätet som många lyssnar på och som kan påverka vad folk köper eller tycker.
informationssamhället – ett samhälle där vi får reda på och delar massor av information hela tiden med internet och teknik.
konsumentverket – en myndighet som jobbar för att skydda oss som köper saker, så vi inte blir lurade av företag.
marknadsföring – sättet företag berättar om sina produkter eller tjänster för att få oss att köpa dem, som reklam.
marknadsföringslagen – regler som bestämmer vad som är okej och inte okej inom reklam och marknadsföring i Sverige.
massmedier – kanaler som når många samtidigt, till exempel TV, radio, tidningar och stora webbplatser.
meddelarskydd – en regel som skyddar personer som berättar viktiga hemliga saker till journalister, så att de inte straffas för det.
medier – samlingsnamn för olika kanaler där man sprider information, som tidningar, TV och internet.
mottagare – den som tar emot information eller ett meddelande, till exempel den som läser ett mejl.
nyhetsförmedling – när journalister samlar in och berättar om det som händer i världen så folk kan veta vad som är på gång.
opinionsbildning – när någon försöker få många att tycka på ett visst sätt om någonting, till exempel politik eller nya regler.
perspektiv – en speciell synvinkel eller åsikt som man har när man berättar om något, som att se en film från olika karaktärers punkt.
produktplacering – när man smyger in en produkt i en film eller serie, så att du ser den men det är inte direkt reklam.
propaganda – när man sprider budskap för att få folk att tycka eller göra som man vill, ofta utan att berätta hela sanningen.
reklam – annonser och budskap där företag visar sina produkter för att vi ska vilja köpa dem.
samhällsinformation – viktig information från myndigheter eller organisationer som hjälper oss veta vad som händer i samhället, till exempel vädervarningar.
sexuellt_ofredande – när någon gör något sexuellt mot dig som du inte vill, som att röra dig på ett sätt du inte gillat eller säga något sexuellt kränkande.
skvaller – prat om andra människor som ofta är privat eller lite hemligt, och ibland inte helt sant.
skärmdump – en bild på allt som syns på din datorskärm eller mobilskärm just nu.
sociala_medier – appar och webbplatser där vi pratar, delar bilder och videos med varandra, som Instagram, TikTok eller Facebook.
sponsring – när ett företag eller någon betalar för t.ex. en idrottare, artist eller program, och får synas genom det.
sändare – den som skickar ut ett meddelande eller en signal, så som en radiostation eller en person som pratar.
tryckfrihet – rätten att skriva och publicera allt man vill utan att staten kan stoppa det, så länge man inte bryter mot andra lagar.
tryckfrihetsförordning – en viktig lag i Sverige som berättar vad som gäller för tryckfrihet, alltså vad man får skriva i tidningar och böcker.
upphovsrätt – regler som säger att den som skapar något (t.ex. en bok, film eller låt) bestämmer vem som får kopiera eller använda det.
värdering – vad man tycker är viktigast eller rätt och fel, som att tycka att vänlighet är viktigt.
yttrandefrihet – rätten att säga och tycka vad man vill, inom lagen, utan att bli straffad.
yttrandefrihetsgrundlagen – en svensk lag som bestämmer att alla får säga vad de vill, så länge man inte bryter mot vissa lagar som förtal eller hets mot folkgrupp.
    </textarea>
    <label>
      Repetitioner Level 1:
      <input type="number" id="level1Input" value="3" min="1">
    </label>
    <label>
      Repetitioner Level 2:
      <input type="number" id="level2Input" value="3" min="1">
    </label>
    <br>
    <button id="loadBtn">Ladda lista</button>
  </div>

  <h2 id="definition"></h2>
  <progress id="progressBar" value="0" max="100"></progress>
  <div id="words"></div>

  <div id="buttonContainer" style="display:none;">
    <button id="restartSameBtn">Starta om (samma lista)</button>
    <button id="newListBtn">Ny lista</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    let data = [];
    let definitions = [];
    let current = 0;
    let gameLevel = 1;
    let level1Rounds = 0;
    let level2Rounds = 0;
    let level1Reps = 3;
    let level2Reps = 3;
    let totalSteps = 0;

    const loadBtn = document.getElementById("loadBtn");
    const restartSameBtn = document.getElementById("restartSameBtn");
    const newListBtn = document.getElementById("newListBtn");
    const buttonContainer = document.getElementById("buttonContainer");
    const progressBar = document.getElementById("progressBar");
    const level1Input = document.getElementById("level1Input");
    const level2Input = document.getElementById("level2Input");

    loadBtn.onclick = () => {
      parseData(document.getElementById("inputData").value);
      // If input is empty, default to 1; otherwise use the provided number (if less than 1, default to 1)
      level1Reps = (level1Input.value === "" ? 1 : (parseInt(level1Input.value) >= 1 ? parseInt(level1Input.value) : 1));
      level2Reps = (level2Input.value === "" ? 1 : (parseInt(level2Input.value) >= 1 ? parseInt(level2Input.value) : 1));
      totalSteps = (level1Reps + level2Reps) * data.length;
      progressBar.max = totalSteps;
      startGame();
      document.getElementById("inputSection").style.display = "none";
      buttonContainer.style.display = "block";
    };

    restartSameBtn.onclick = startGame;
    newListBtn.onclick = resetGame;

    function startGame() {
      gameLevel = 1;
      level1Rounds = 0;
      level2Rounds = 0;
      current = 0;
      updateProgressBar();
      startLevel1();
    }

    function resetGame() {
      document.getElementById("inputSection").style.display = "block";
      document.getElementById("definition").textContent = "";
      document.getElementById("words").innerHTML = "";
      progressBar.value = 0;
      buttonContainer.style.display = "none";
    }

    function parseData(text) {
      data = [];
      const lines = text.split('\n');
      const regex = /^(\S+)\s*(?:-\s*)?(.*)$/;
      lines.forEach(line => {
        if (line.trim() === "") return;
        const match = line.match(regex);
        if (match) {
          data.push({ word: match[1], def: match[2] });
        }
      });
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function triggerFirework() {
      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
    }

    function triggerShake(el) {
      el.classList.add("shake");
      setTimeout(() => el.classList.remove("shake"), 300);
    }

    function updateProgressBar() {
      let completedSteps = 0;
      if (gameLevel === 1) {
        completedSteps = (level1Rounds * data.length) + current;
      } else if (gameLevel === 2) {
        completedSteps = (level1Reps * data.length) + (level2Rounds * data.length) + current;
      }
      progressBar.value = completedSteps;
    }

    // Level 1: Clickable buttons
    function startLevel1() {
      definitions = [...data];
      shuffle(definitions);
      current = 0;
      showDefinitionLevel1();
    }

    function showDefinitionLevel1() {
      if (current >= definitions.length) {
        level1Rounds++;
        if (level1Rounds < level1Reps) {
          startLevel1();
        } else {
          gameLevel = 2;
          level2Rounds = 0;
          startLevel2();
        }
        updateProgressBar();
        return;
      }
      document.getElementById("definition").textContent = definitions[current].def;
      const wordsDiv = document.getElementById("words");
      wordsDiv.innerHTML = "";
      data.forEach(item => {
        const btn = document.createElement("button");
        btn.textContent = item.word;
        btn.onclick = () => {
          if (item.word === definitions[current].word) {
            btn.classList.add("correct");
            triggerFirework();
            current++;
            updateProgressBar();
            setTimeout(showDefinitionLevel1, 1000);
          } else {
            btn.classList.add("wrong");
            triggerShake(btn);
          }
        };
        wordsDiv.appendChild(btn);
      });
    }

    // Level 2: Text input
    function startLevel2() {
      definitions = [...data];
      shuffle(definitions);
      current = 0;
      showDefinitionLevel2();
    }

    function showDefinitionLevel2() {
      if (current >= definitions.length) {
        level2Rounds++;
        if (level2Rounds < level2Reps) {
          startLevel2();
        } else {
          document.getElementById("definition").textContent = "Klart!";
          document.getElementById("words").innerHTML = "";
        }
        updateProgressBar();
        return;
      }
      document.getElementById("definition").textContent = definitions[current].def;
      const wordsDiv = document.getElementById("words");
      wordsDiv.innerHTML = "";
      
      const input = document.createElement("input");
      input.type = "text";
      input.id = "answerInput";
      // No placeholder attribute
      wordsDiv.appendChild(input);
      
      const checkBtn = document.createElement("button");
      checkBtn.textContent = "Kolla";
      checkBtn.onclick = checkAnswerLevel2;
      wordsDiv.appendChild(checkBtn);
      
      input.focus();
      input.addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
          checkAnswerLevel2();
        }
      });
    }

    function checkAnswerLevel2() {
      const input = document.getElementById("answerInput");
      const answer = input.value.trim();
      if (answer.toLowerCase() === definitions[current].word.toLowerCase()) {
        input.classList.add("correct");
        triggerFirework();
        current++;
        updateProgressBar();
        setTimeout(showDefinitionLevel2, 1000);
      } else {
        input.classList.add("wrong");
        triggerShake(input);
      }
    }
  </script>
</body>
</html>

